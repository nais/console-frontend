<script lang="ts">
	import { severityToColor } from '$lib/utils/vulnerabilities';
	import { Heading } from '@nais/ds-svelte-community';

	const {
		vulnerabilitySummary
	}: {
		vulnerabilitySummary: {
			sbomCount: number;
			coverage: number;
			critical: number;
			riskScore: number;
		};
	} = $props();
</script>

<div class="summary">
	<Heading size="small" level="2" spacing>Vulnerability Summary</Heading>
	<div class="grid">
		<span>{vulnerabilitySummary.sbomCount}</span>
		<div>SBOM count</div>
		<span
			style={vulnerabilitySummary.coverage < 90 ? 'color: var(--ax-text-danger)' : 'color: inherit'}
			>{Math.round(vulnerabilitySummary.coverage)}%</span
		>
		<div>SBOM coverage</div>

		<span
			class="vulnerability-count"
			style:background-color={vulnerabilitySummary.critical
				? severityToColor({ severity: 'critical' })
				: undefined}>{vulnerabilitySummary.critical}</span
		>
		<div>Critical vulnerabilities</div>

		<div>
			{vulnerabilitySummary.riskScore}
		</div>
		<div>Total risk score</div>
	</div>
</div>

<style>
	.grid {
		display: grid;
		grid-template-columns: auto 1fr;
		column-gap: var(--ax-space-16);
		row-gap: var(--ax-space-24);
		align-items: center;
		border: 1px solid var(--ax-border-default);

		> :nth-child(2n + 1) {
			font-size: 2rem;
			font-weight: 600;
			justify-self: center;
		}
	}

	.vulnerability-count {
		border-radius: 4px;
		padding: 4px 16px;
	}

	.summary {
		background-color: var(--ax-bg-sunken);
		padding: var(--ax-space-20);
		border-radius: 12px;
	}
</style>
