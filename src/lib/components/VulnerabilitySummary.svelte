<script lang="ts">
	import { graphql } from '$houdini';
	import { Heading } from '@nais/ds-svelte-community';
	import type { VulnerabilitySummaryVariables } from './$houdini';
	import VulnerabilityBadges from './VulnerabilityBadges.svelte';

	interface Props {
		teamSlug: string;
	}

	let { teamSlug }: Props = $props();

	export const _VulnerabilitySummaryVariables: VulnerabilitySummaryVariables = () => {
		return { team: teamSlug };
	};

	const vulnerabilities = graphql(`
		query VulnerabilitySummary($team: Slug!) @cache(policy: NetworkOnly) @load {
			team(slug: $team) @loading {
				vulnerabilitySummary @loading {
					critical
					high
					low
					medium
					riskScore
					unassigned
					bomCount
					coverage
				}
			}
		}
	`);

	let team = $derived($vulnerabilities.data?.team);
</script>

{#if team}
	<div class="summary">
		<Heading level="4" size="small" spacing>Vulnerabilities</Heading>
		{#if team.vulnerabilitySummary}
			<VulnerabilityBadges summary={team.vulnerabilitySummary} />
		{/if}
		<a href="/team/{teamSlug}/vulnerabilities">View team vulnerabilites</a>
	</div>
{/if}

<style>
	.summary {
		display: flex;
		flex-direction: column;
		gap: var(--a-spacing-1);
	}
</style>
