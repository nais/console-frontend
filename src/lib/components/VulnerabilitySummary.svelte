<script lang="ts">
	import { graphql, PendingValue } from '$houdini';
	import type { VulnerabilitySummaryVariables } from './$houdini';
	import RiskStack from './RiskStack.svelte';

	interface Props {
		teamSlug: string;
	}

	let { teamSlug }: Props = $props();

	export const _VulnerabilitySummaryVariables: VulnerabilitySummaryVariables = () => {
		return { team: teamSlug };
	};

	const vulnerabilities = graphql(`
		query VulnerabilitySummary($team: Slug!) @cache(policy: NetworkOnly) @load {
			team(slug: $team) @loading {
				vulnerabilitySummary @loading {
					critical
					high
					low
					medium
					riskScore
					unassigned
					bomCount
					coverage
				}
			}
		}
	`);

	let team = $derived($vulnerabilities.data?.team);
</script>

{#if team}
	<div class="wrapper">
		{#if team.vulnerabilitySummary && team.vulnerabilitySummary !== PendingValue}
			<RiskStack summary={team.vulnerabilitySummary} />
		{/if}
		<a href="/team/{teamSlug}/vulnerabilities">View team vulnerabilites</a>
	</div>
{/if}

<style>
	.wrapper {
		display: flex;
		flex-direction: column;
		gap: var(--a-spacing-1);
		align-items: start;
	}
</style>
